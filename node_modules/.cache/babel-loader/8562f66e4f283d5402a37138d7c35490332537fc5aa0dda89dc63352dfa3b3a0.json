{"ast":null,"code":"// minimal implementation MurmurHash2 hash function\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"BloomFilter\", {\n  enumerable: true,\n  get: function () {\n    return BloomFilter;\n  }\n});\nfunction murmurhash2(str) {\n  let h = 0;\n  for (let i = 0; i < str.length; i++) {\n    const c = str.charCodeAt(i);\n    h = Math.imul(h ^ c, 0x5bd1e995);\n    h ^= h >>> 13;\n    h = Math.imul(h, 0x5bd1e995);\n  }\n  return h >>> 0;\n}\n// default to 0.01% error rate as the filter compresses very well\nconst DEFAULT_ERROR_RATE = 0.0001;\nclass BloomFilter {\n  static from(items, errorRate) {\n    if (errorRate === void 0) errorRate = DEFAULT_ERROR_RATE;\n    const filter = new BloomFilter(items.length, errorRate);\n    for (const item of items) {\n      filter.add(item);\n    }\n    return filter;\n  }\n  export() {\n    const data = {\n      numItems: this.numItems,\n      errorRate: this.errorRate,\n      numBits: this.numBits,\n      numHashes: this.numHashes,\n      bitArray: this.bitArray\n    };\n    if (process.env.NEXT_RUNTIME === \"nodejs\") {\n      if (this.errorRate < DEFAULT_ERROR_RATE) {\n        const filterData = JSON.stringify(data);\n        const gzipSize = require(\"next/dist/compiled/gzip-size\").sync(filterData);\n        if (gzipSize > 1024) {\n          console.warn(\"Creating filter with error rate less than 0.1% (0.001) can increase the size dramatically proceed with caution. Received error rate \" + this.errorRate + \" resulted in size \" + filterData.length + \" bytes, \" + gzipSize + \" bytes (gzip)\");\n        }\n      }\n    }\n    return data;\n  }\n  import(data) {\n    this.numItems = data.numItems;\n    this.errorRate = data.errorRate;\n    this.numBits = data.numBits;\n    this.numHashes = data.numHashes;\n    this.bitArray = data.bitArray;\n  }\n  add(item) {\n    const hashValues = this.getHashValues(item);\n    hashValues.forEach(hash => {\n      this.bitArray[hash] = 1;\n    });\n  }\n  contains(item) {\n    const hashValues = this.getHashValues(item);\n    return hashValues.every(hash => this.bitArray[hash]);\n  }\n  getHashValues(item) {\n    const hashValues = [];\n    for (let i = 1; i <= this.numHashes; i++) {\n      const hash = murmurhash2(\"\" + item + i) % this.numBits;\n      hashValues.push(hash);\n    }\n    return hashValues;\n  }\n  constructor(numItems, errorRate = DEFAULT_ERROR_RATE) {\n    this.numItems = numItems;\n    this.errorRate = errorRate;\n    this.numBits = Math.ceil(-(numItems * Math.log(errorRate)) / (Math.log(2) * Math.log(2)));\n    this.numHashes = Math.ceil(this.numBits / numItems * Math.log(2));\n    this.bitArray = new Array(this.numBits).fill(0);\n  }\n}","map":{"version":3,"names":["BloomFilter","murmurhash2","str","h","i","length","c","charCodeAt","Math","imul","DEFAULT_ERROR_RATE","from","items","errorRate","filter","item","add","export","data","numItems","numBits","numHashes","bitArray","process","env","NEXT_RUNTIME","filterData","JSON","stringify","gzipSize","require","sync","console","warn","import","hashValues","getHashValues","forEach","hash","contains","every","push","constructor","ceil","log","Array","fill"],"sources":["../../../src/shared/lib/bloom-filter.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}